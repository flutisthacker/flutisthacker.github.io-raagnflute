<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>raag</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

</head>
<body>
    <style>
        .raags{
            /* text-decoration: dashed; */
            /* text-decoration: dotted; */
            /* text-decoration: double; */
            /* text-decoration:line-through; */
            /* text-decoration:overline; */
            /* text-decoration:solid; */
            /* text-decoration:underline; this*/
            /* text-decoration:wavy; */
        }
    </style>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Raag and Flute</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0 raags">
          <li class="nav-item">
            <select class="nav-link" name="" id="chooseTime">
                <option value="Empty">Choose the time</option>
                <option value="Morning">Morning</option>
                <option value="Afternoon">Afternoon</option>
                <option value="Evening">Evening</option>
                <option value="Dawn">Dawn</option>
                <option value="Dusk">Dusk</option>
                <option value="Midnight">Midnight</option>
                <option value="Twilight">Twilight</option>
                <option value="Night">Night</option>
            </select>
          </li>
        <li class="nav-item">
            <select class="nav-link" name="" id="chooseThaat">
                <option value="Empty">Choose the thaat</option>
            </select>
        </li>
        <li class="nav-item">
            <select class="nav-link" name="" id="chooseRaag">
                <option value="Empty">Choose the raag</option>
            </select>
        </li>
        <li class="nav-item">
            <select class="nav-link" name="" id="RaagSong">
                <option value="Empty">Choose the song</option>
                <!-- <option value="saarang">Saarang</option>
                <option value="bhoopali">bhoopali</option>
                <option value="bhairav">bhairav</option> -->
            </select>
        </li>
        <div class="d-flex">
            <button class="btn btn-primary" onclick="history.go(0)"> <i class="fas fa-recycle"></i></button>
        </div>

        <h5  class="btn btn-outline-primary position-relative raagh5">
            Raag
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
              99+
              <span class="visually-hidden">unread messages</span>
            </span>
          </h5>
          <button onClick="mytimint=setInterval(myTimer, 60000/beat)" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal"><i class="fa fa-play"></i></button>
        <!-- <button class="btn btn-primary">Transpose</button> -->

        <!-- <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Dropdown
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              <li><a class="dropdown-item" href="#">Action</a></li>
              <li><a class="dropdown-item" href="#">Another action</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="#">Something else here</a></li>
            </ul>
          </li> -->
        </ul>

      </div>
    </div>
  </nav>
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">play the song</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <p id="timer"></p>
            <p id="note"></p>
        </div>
        <div class="modal-footer">
          <button onClick="clearInterval(mytimint)" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button onClick="mytimdd=1" type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>


         <div class="row jumbotron">
            <div class="col-lg-3 col-md-6 col-sm-6 raginfo"></div>
            <div class="col-lg-9 col-md-6 col-sm-6 list"></div>
        </div>        


    <script src="raagJson.js"></script>
    <script src="transpose2.js"></script>
    <script src="music.js"></script>
    <script>
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        var mytimint,mytimeout;
        
        function play(frequency,times){
            // create Oscillator node
            otype="triangle";
            // sine square triangle sawtooth
            const oscillator = audioCtx.createOscillator();
            oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
            let g = audioCtx.createGain();
            oscillator.type = otype;        
            oscillator.connect(g)
            g.connect(audioCtx.destination)
            oscillator.start()
            g.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 2 * times)
            // create web audio api context
        }
    
            var beat =120
            var mytimd=1;
            var mytimdd=-8;
            var prevnote="";
            var currnote="";
            var mybeatcount=0;
            function playrandom(){
                // randomNote=Math.floor(Math.random()*noteFrequency.length)
                // play(noteFrequency[randomNote])
                play(311.1,1)
                play(261.6,1)
                play(370.0,1)
            }
            function myTimer(){
                if(mytimd>8){
                    document.getElementById("timer").innerHTML ="";
                    document.getElementById("note").innerHTML +="</br>";
                    mytimd=1;
                }
                document.getElementById("timer").innerHTML += mytimd++ + "    ";
                document.getElementById("note").innerHTML += `<button class="btn">${eval(raagSong.value)[mytimdd] || mytimd-1}</button> `+ "    " ;
                mytimdd++;
                // console.log(noteFrequency[notes.indexOf(mynoted[mytimdd-1])])
                playnote(eval(raagSong.value),mytimdd)
            }
    
            var twonotes;
            function myTimer1(){
                mybeatcount++;
                play(noteFrequency[notes.indexOf(twonotes[mybeatcount])],.5)
                if(mybeatcount == twonotes.length){
                    clearInterval(mytimeout)
                }
            }
    
            function playnote(mynotedd,mytimdd){
                // console.log("mynotedd"+mynotedd)
                if(mytimdd>=mynotedd.length){
                    // my current beat is greater than  the total note length
                    clearInterval(mytimint);
                }
                if(notes.indexOf(mynotedd[mytimdd-1]) == (notes.length-1)){
                    // index of the note in current beat is equal to the -
                    // without randomNOte the note is played twice rathe than extending
                    play(prevnote[randomNote],2)
                }
                else{
                    // previous note is stored in frequency and played on else
                    prevnote=noteFrequency[notes.indexOf(mynotedd[mytimdd-1])]
                    // ["ab"]
                    if(mynotedd[mytimdd-1].length>1){
                        //if the length of current note is >1 suppose ab or bca
                        // console.log("else",mynotedd[mytimdd-1].length,mynotedd[mytimdd-1])
                        currnote=mynotedd[mytimdd-1]
                        // twonotes=mynotedd[mytimdd-1].split("");
                        mybeatcount=0;
                        twonotes=currnote.split("");
                        mytimeout= setInterval(myTimer1, 250)
                            // var mytimeout=setInterval(play(440,1),250)
                            // setTimeout(clearInterval(mytimeout),500)
                    }else{
                        play(prevnote,1)
                    }
                }
            }
    
    </script>
    <script>
        // console.table(raags.raag)
        var chooseThaat=document.querySelector("#chooseThaat");
        var chooseRaag=document.querySelector("#chooseRaag");
        var chooseTime=document.querySelector("#chooseTime")
        var raagSong = document.querySelector("#RaagSong")
        var timeBadge={"morning":0,"evening":0,"night":0,"midnight":0,"afternoon":0,"dawn":0,"empty":0};
        var totalRaag=0;

        document.addEventListener("keypress",e=>{
            if(e.keyCode ==15){
                
            }
        })
        getBadge()
        document.querySelector(".start-100").textContent=totalRaag
        document.querySelector(".raagh5").innerHTML+=`(${Object.keys(raags.raag).length})`


        function getBadge(){
            Object.keys(raags.raag).forEach(a=>{
                    switch(raags.raag[a].time) {
                        case "morning" || "Morning":
                                timeBadge["morning"]+=1
                            break;
                        case "evening"|| "Evening":
                                timeBadge["evening"]+=1
                            break;
                        case "afternoon" || "Afternoon":
                                timeBadge["afternoon"]+=1
                            break;
                        case "dawn" || "Dawn":
                                timeBadge["dawn"]+=1
                            break;
                        case "empty":
                                timeBadge["empty"]+=1
                            break;
                        case "night"|| "Night":
                                timeBadge["night"]+=1
                            break;
                        case "midnight"|| "Midnight":
                                timeBadge["midnight"]+=1
                            break;
                        default:
                            // code block
                        }
                })

                for(i=0;i<9;i++){
                    console.log(chooseTime.options[i].text)
                    var ctot =chooseTime.options[i].text
                    if(timeBadge[ctot.toLowerCase()] != undefined){
                        chooseTime.options[i].text = ctot + `(${timeBadge[ctot.toLowerCase()]})`
                    }
                }
                Object.keys(songraag).forEach(rag=>{
                totalRaag= totalRaag+(Object.keys(songraag[rag]).length)
                })
        }
        chooseThaat.addEventListener("change",()=>{
            selectRaag("thaat")
        })
        chooseRaag.addEventListener("change",()=>{
            selectSong()
        })
        chooseTime.addEventListener("change",()=>{
            selectRaag("time")
        })

        // Object.keys(songraag).forEach(ard=>{
        //     raagSong.innerHTML+= `<option value="${ard}">${ard}</option>`
        // });

        Object.keys(thaat).forEach((sard,key)=>{
            chooseThaat.innerHTML+= `<option value="${sard}">${sard}</option>`
        });

        raagSong.addEventListener("change",()=>{
            var ragsong = raagSong.value
            transpose(eval(ragsong),Nepnotes,8);
        })
        chooseRaag.addEventListener("change",()=>{
            var timeValue = chooseRaag            
            // console.log(timeValue.options[timeValue.selectedIndex].text)
            giveINfo(timeValue.value)
        })

        function selectRaag(thaatime){
            var tvalue;
            let rag;
            if(thaatime== "time"){
                var tvalue = chooseTime.value
            }
            else{
                var tvalue = chooseThaat.value
            }
            // chooseRaag.innerHTML
            var abcde=Object.keys(raags.raag)
            // var rand= Math.floor(Math.random(4)*4);
            // let durations= ["Night","Morning","Afternoon","Evening"]
            // console.log(durations[rand],rand)
            abcde.forEach(abc=>{

                if(thaatime== "time"){
                    rag=(raags.raag[abc].time);
                }
                else{
                    rag=(raags.raag[abc].thaat);
                }
            if( rag == tvalue || rag == tvalue.toLowerCase()){
                ragoption=document.createElement("option")
                ragoption.value= abc;
                ragoption.textContent= abc;
                chooseRaag.appendChild(ragoption)
            }
    })

    }

//     getText("https://flutisthacker.github.io/flutisthacker.github.io-gamemaybe/varnotes.js");

// async function getText(file) {
//   let myObject = await fetch(file);

//   let myText = await myObject.text();
//   document.getElementById("demo").innerHTML = myText;
// }

    function selectSong(){
            var tvalue = chooseRaag.value
            var abcde=Object.keys(songraag)
            abcde.forEach(abc=>{
                let rag=Object.keys(songraag[abc]);
            if( abc == tvalue || abc == tvalue.toLowerCase()){
                rag.forEach(ragg=>{
                    ragoption=document.createElement("option")
                    ragoption.value= `songraag["${abc}"]["${ragg}"]`;
                    ragoption.textContent= ragg;
                    raagSong.appendChild(ragoption)
                })    
            }
    })
    }


        function giveINfo(raagname){
            document.querySelector(".raginfo").innerHTML=""
            var raginfo=raags.raag[raagname]
            raginfokeys= Object.keys(raags.raag[raagname])

            let ragCard= document.createElement("div")
            ragCard.className ="card"
            ragCard.style= "width:18rem"

            let ragBody= document.createElement("div")
            ragBody.className ="card-body"

            let ragTitle= document.createElement("div")
            ragTitle.className ="card-header"
            ragTitle.textContent=raagname


            let ragUL= document.createElement("ul")
            ragUL.className ="list-group list-group-flush"

            raginfokeys.forEach(raginfokey=>{
                ragUL.innerHTML+=(`<li class="list-group-item">${raginfokey}: ${raags.raag[raagname][raginfokey]}</li>`)
            })

            ragCard.appendChild(ragTitle)
            ragBody.appendChild(ragUL) 
            ragCard.appendChild(ragBody)
            document.querySelector(".raginfo").appendChild(ragCard)
        }

    </script>
</body>
</html>